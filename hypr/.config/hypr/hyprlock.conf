# 变量定义
$text_color = rgba(216, 222, 233)
$entry_bg_color = rgba(255, 255, 255, 0.2)
$font_family = CaskaydiaMono Nerd Font
$font_family_mono = CaskaydiaMono Nerd Font Mono

background {
    monitor =
    path = ~/.config/omarchy/current/background

    blur_passes = 2           # 模糊次数。次数越多越平滑，但更消耗性能 (建议 1-4)
    blur_size = 2             # 模糊半径。数值越大越模糊
    noise = 0.0117            # 增加一点噪点，让模糊看起来更有质感
    contrast = 0.8916         # 对比度调整
    brightness = 0.8172       # 亮度调整
    vignette = 0.2            # 边缘暗角
    vignette_intensity = 0.5  # 暗角强度


}

# ==========================================
# 1. 登录区块 (头像 + 欢迎语 + 登录栏)
# ==========================================

# 登录区块大背景
shape {
    monitor =
    size = 450, 320
    color = $entry_bg_color
    rounding = 20
    position = 0, 30
    halign = center
    valign = center
}

# 头像
image {
    monitor =
    path = ~/.config/hypr/imgs/avatar/myAvatar.jpg
    size = 120
    rounding = -1
    border_size = 2
    border_color = $text_color
    position = 0, 110
    halign = center
    valign = center
}

# 欢迎语
label {
    monitor =
    text = cmd[update:30000] echo "$(hour=$(date +%H); if [ $hour -lt 12 ]; then echo "早上好, Monwin"; elif [ $hour -lt 18 ]; then echo "下午好, Monwin"; else echo "晚上好, Monwin"; fi)"
    color = $text_color
    font_size = 22
    font_family = $font_family
    position = 0, 10
    halign = center
    valign = center
}

# 用户名 (左侧)
label {
    monitor =
    text = $USER
    color = $text_color
    font_size = 20
    font_family = $font_family
    position = -110, -70
    halign = center
    valign = center
}

# 输入框 (右侧)
input-field {
    monitor =
    size = 220, 50
    outline_thickness = 0
    inner_color = rgba(255, 255, 255, 0.1)
    font_color = rgb(200, 200, 200)
    fade_on_empty = false
    placeholder_text = <span foreground="##FDFEFE">请输入密码</span>
    position = 30, -70
    halign = center
    valign = center
}

# ==========================================
# 2. 右侧模块 (长方形时钟 + 日历)
# ==========================================

# 时钟
shape {
    monitor =
    size = 320, 100
    color = $entry_bg_color
    rounding = 15
    position = 420, 190
    halign = center
    valign = center
}

label {
    monitor =
    text = $TIME
    color = $text_color
    font_size = 45
    font_family = $font_family
    position = 420, 190
    halign = center
    valign = center
}

# 日历 (增强版显示脚本)
shape {
    monitor =
    size = 320, 240
    color = $entry_bg_color
    rounding = 15
    position = 420, -30
    halign = center
    valign = center
}

label {
    monitor =
    # 强制英文对齐，并使用 printf 处理换行
    text = cmd[update:3600000] LC_TIME=en_US.UTF-8 cal | sed 's/^/  /' 
    color = $text_color
    font_size = 14
    font_family = $font_family_mono
    position = 420, -30
    halign = center
    valign = center
}
# ==========================================
# 3. 左侧模块 (手动切换的状态图)
# ==========================================

image {
    monitor =
    path = /home/mo/.config/hypr/current_status.png  # 始终读取这个软链接
    size = 220
    rounding = 15
    border_size = 2
    border_color = $text_color
    
    # 关键：每隔 1 秒重新加载一次图片文件
    # 这样当你按快捷键改变软链接指向时，锁屏会立即刷新图片
    reload_time = 1 
    reload_cmd = 
    
    position = -400, 150
    halign = center
    valign = center
}

# 可选：在图片下方显示当前文件名
# label {
#     monitor =
#     text = cmd[update:1000] echo "$(basename $(readlink ~/.config/hypr/current_status.png))"
#     color = $text_color
#     font_size = 12
#     font_family = $font_family
#     position = -420, 0
#     halign = center
#     valign = center
# }


shape {
    monitor =
    size = 280, 150
    color = $entry_bg_color
    rounding = 15
    position = -400, -100
    halign = center
    valign = center
}

label {
    monitor =
    text = cmd[update:2000] echo -e "󰻠 CPU: $(top -bn1 | grep 'Cpu(s)' | awk '{print $2+$4}')%\n󰍛 MEM: $(free -m | awk '/Mem:/ {printf "%.1fG/%.1fG", $3/1024, $2/1024}')\n󰋊 DISK: $(df -h / | awk 'NR==2 {print $5}')"
    color = $text_color
    font_size = 14
    font_family = $font_family
    position = -400, -100
    halign = center
    valign = center
}

# ==========================================
# 4. 上方 & 媒体播放 (下方)
# ==========================================

# 顶部装饰图
image {
    monitor =
    path = ~/.config/hypr/myAvatar.jpg
    size = 150
    rounding = 10
    position = 0, 360
    halign = center
    valign = center
}

# ==========================================
# 4. 下方模块 (媒体播放显示 - 带背景)
# ==========================================

# 媒体播放背景
shape {
    monitor =
    size = 320, 80          # 宽度与登录区块一致，高度自适应一行文字
    color = $entry_bg_color
    rounding = 40
    position = 0, -200      # 位于登录区块下方
    halign = center
    valign = center
}

# 媒体播放文字内容
label {
    monitor =
    # 逻辑：标题和艺术家如果超过 4 个字，都显示为 "前四位..."
    text = cmd[update:1000] status=$(playerctl status 2>/dev/null); icon="󰐊"; [[ "$status" = "Playing" ]] && icon="󰏤"; if [ -n "$status" ]; then title=$(playerctl metadata title); artist=$(playerctl metadata artist); disp_title=$(echo "$title" | awk '{print (length($0) > 4) ? substr($0, 1, 4) ".." : $0}'); disp_artist=$(echo "$artist" | awk '{print (length($0) > 4) ? substr($0, 1, 4) ".." : $0}'); echo "$icon  $disp_title - $disp_artist"; else echo "󰓄 无媒体播放"; fi
    color = $text_color
    font_size = 16
    font_family = $font_family
    position = 0, -200
    halign = center
    valign = center
}
